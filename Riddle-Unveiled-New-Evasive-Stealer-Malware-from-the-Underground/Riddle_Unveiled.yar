rule Riddle_Unveiled {
    meta:
        author = "Seyit (@mseyit_) - ThreatMon"
        description = "Detects the Riddle stealer"
        date = "23.10.2023"
        hash = "3771E204B354353A88A9E180E56BFD043A39F9AF40F9672E6370D4A7081C3F21"
        
    strings:
        $str1 = "127.0.0.1 www.virustotal\.com" nocase
        $str2 = "127.0.0.1 virustotal\.com" nocase
        $str3 = "127.0.0.1 app.any\.run" nocase
        $str4 = "127.0.0.1 any\.run" nocase
        $str5 = "SELECT * FROM AntiVirusProduct" nocase
        $str6 = "HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0" nocase
        $str7 = "PhoneNumber.txt" nocase
        $str8 = "DeviceInfo.txt" nocase
        $str9 = "InstalledSoftware.txt" nocase
        $str10 = "ActivitiesCache.db" nocase
        $str11 = "LastUsed.txt" nocase
        $str12 = "C:\\Windows\\System32\\drivers\\etc\\hosts" nocase
        $imp1 = "GetCurrentHwProfileA" nocase
        $imp2 = "GetClipboardData" nocase
        $imp3 = "CreateCompatibleBitmap" nocase
        $imp4 = "CreateMutexA" nocase
        
    condition:
        uint16(0) == 0x5A4D and 
		all of ($imp*) and 
		3 of ($str*)
}
